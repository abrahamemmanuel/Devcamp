{"version":3,"sources":["../../../../src/server/api/profile/controllers.js"],"names":["ProfileCoontroller","req","res","errors","Profile","findOne","user","id","populate","then","profile","noprofile","status","render","catch","err","json","body","isValid","redirect","profileFields","handle","company","website","location","bio","githubusername","skills","split","social","youtube","twitter","facebook","instagram","linkedin","findOneAndUpdate","$set","new","save","newEdu","school","degree","fieldofstudy","from","to","current","description","education","unshift","profileController"],"mappings":"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","sourcesContent":["/* eslint-disable class-methods-use-this */\r\nimport mongoose from 'mongoose';\r\nimport Profile from '../../..//database/models/Profile';\r\nimport User from '../../..//database/models/User';\r\nimport validateProfileInput from '../../../utils/validation/profile';\r\n\r\nclass ProfileCoontroller {\r\n  getCurrentUserProfile(req, res) {\r\n    const errors = {};\r\n    Profile.findOne({ user: req.user.id })\r\n      .populate('user', ['name', 'avatar'])\r\n      .then(profile => {\r\n        if (!profile) {\r\n          // Add to the errors object\r\n          errors.noprofile = \"You don't have a profile yet\";\r\n          return res.status(400).render('create-profile', { errors });\r\n        } else {\r\n          return res.status(200).render('private-profile', { profile });\r\n        }\r\n      })\r\n      .catch(err => res.status(501).json(err));\r\n  }\r\n\r\n  editProfile(req, res) {\r\n    Profile.findOne({ user: req.user.id })\r\n      .populate('user', ['name', 'avatar'])\r\n      .then(profile => res.status(200).render('edit-profile', { profile }));\r\n  }\r\n\r\n  createUserProfile(req, res) {\r\n    const { errors, isValid } = validateProfileInput(req.body);\r\n\r\n    // Check validation\r\n    if (!isValid) {\r\n      // Return any errors with 400 status\r\n      return res.status(400).redirect('/api/profile', { errors });\r\n    }\r\n\r\n    // Get fields\r\n    const profileFields = {};\r\n    profileFields.user = req.user.id;\r\n    if (req.body.handle) profileFields.handle = req.body.handle;\r\n    if (req.body.company) profileFields.company = req.body.company;\r\n    if (req.body.website) profileFields.website = req.body.website;\r\n    if (req.body.location) profileFields.location = req.body.location;\r\n    if (req.body.bio) profileFields.bio = req.body.bio;\r\n    if (req.body.status) profileFields.status = req.body.status;\r\n    if (req.body.githubusername) profileFields.githubusername = req.body.githubusername;\r\n    // Skills split into array\r\n    if (typeof req.body.skills !== 'undefined') {\r\n      profileFields.skills = req.body.skills.split(',');\r\n    }\r\n\r\n    // Social\r\n    profileFields.social = {};\r\n    if (req.body.youtube) profileFields.social.youtube = req.body.youtube;\r\n    if (req.body.twitter) profileFields.social.twitter = req.body.twitter;\r\n    if (req.body.facebook) profileFields.social.facebook = req.body.facebook;\r\n    if (req.body.instagram) profileFields.social.instagram = req.body.instagram;\r\n    if (req.body.linkedin) profileFields.social.linkedin = req.body.linkedin;\r\n\r\n    Profile.findOne({ user: req.user.id })\r\n      .populate('user', ['name', 'avatar'])\r\n      .then(profile => {\r\n        if (profile) {\r\n\r\n          // Update\r\n          Profile.findOneAndUpdate(\r\n            { user: req.user.id },\r\n            { $set: profileFields },\r\n            { new: true }\r\n          ).then(profile => res.status(200).render('edit-profile', { profile }));\r\n        } else {\r\n          //Create\r\n\r\n          // Check if handle exist\r\n          Profile.findOne({ handle: profileFields.handle }).then(profile => {\r\n            if (profile) {\r\n              // Add to errors\r\n              errors.handle = 'That handle already exist';\r\n              return res.status(400).render('create-profile', { errors });\r\n            }\r\n\r\n            // Save Profile\r\n            new Profile(profileFields)\r\n              .save()\r\n              .then(profile => res.status(200).render('private-profile', { profile }));\r\n          });\r\n        }\r\n      });\r\n\r\n  }\r\n\r\n  getExperiencePage(req, res) {\r\n    res.status(200).render('add-experience');\r\n  }\r\n\r\n  getEducationPage(req, res) {\r\n    res.status(200).render('add-education');\r\n  }\r\n\r\n  addEducation(req, res) {\r\n    // Find loggedin user by id\r\n    Profile.findOne({ user: req.user.id })\r\n      .then(profile => {\r\n        // create new Education object\r\n        const newEdu = {\r\n          school: req.body.school,\r\n          degree: req.body.degree,\r\n          fieldofstudy: req.body.fieldofstudy,\r\n          from: req.body.from,\r\n          to: req.body.to,\r\n          current: req.body.current,\r\n          description: req.body.description\r\n        }\r\n\r\n        // Add to edu array\r\n        profile.education.unshift(newEdu);\r\n\r\n        profile.save().then(profile => res.redirect('/api/profile/dashboard'))\r\n      });\r\n  }\r\n\r\n  dashboard(req, res) {\r\n    Profile.findOne({ user: req.user.id })\r\n      .populate('user', ['name', 'isLoggedIn'])\r\n      .then(profile => res.status(200).render('dashboard', { profile }))\r\n  }\r\n}\r\n\r\nconst profileController = new ProfileCoontroller();\r\n\r\nexport default profileController;\r\n"],"file":"controllers.js"}